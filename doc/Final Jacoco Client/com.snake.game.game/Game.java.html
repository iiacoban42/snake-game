<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Game.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">template</a> &gt; <a href="index.source.html" class="el_package">com.snake.game.game</a> &gt; <span class="el_source">Game.java</span></div><h1>Game.java</h1><pre class="source lang-java linenums">package com.snake.game.game;

import com.badlogic.gdx.graphics.Color;
import com.snake.game.game.powerup.PowerUp;
import com.snake.game.game.powerup.PowerUpFactory;
import com.snake.game.game.powerup.PowerUpName;
import com.snake.game.game.states.ActiveGameState;
import com.snake.game.game.states.FinishedGameState;
import com.snake.game.game.states.GameState;
import com.snake.game.game.states.GameStateName;
import com.snake.game.game.states.NewGameState;
import com.snake.game.game.states.PauseGameState;

import java.util.ArrayList;
import java.util.HashMap;

/**
 * Class that represents the game that can be in 1 of 3 active states (active, paused, finished).
 * Houses the board, and each state class contains the logic of what to execute for the game
 */
<span class="pc bpc" id="L21" title="1 of 2 branches missed.">public class Game {</span>

<span class="fc" id="L23">    private boolean portalWalls = false;</span>
<span class="fc" id="L24">    private boolean stopGrowFlag = false;</span>
<span class="fc" id="L25">    private final transient int maxApples = 20;</span>

    private Snake snake;
    private ArrayList&lt;Apple&gt; apples;
    private PowerUp powerUp;
    private PowerUpFactory powerUpFactory;

    private Board board;
    private SoundSystem soundSystem;
    private Score score;

    private GameState state;
<span class="fc" id="L37">    private final HashMap&lt;GameStateName, GameState&gt; states = new HashMap&lt;&gt;();</span>

    public Timer&lt;Runnable&gt; gameUpdateTimer;

    public void setGameUpdateTimer(Timer&lt;Runnable&gt; gameUpdateTimer) {
<span class="nc" id="L42">        this.gameUpdateTimer = gameUpdateTimer;</span>
<span class="nc" id="L43">    }</span>

    /**
     * Construct a new Game.
     *
     * @param board board to play on
     * @param score system that holds the score
     * @param soundSystem system that can play necessary sounds
     */
<span class="fc" id="L52">    public Game(Board board, Score score, SoundSystem soundSystem) {</span>
<span class="fc" id="L53">        this.board = board;</span>
<span class="fc" id="L54">        this.score = score;</span>
<span class="fc" id="L55">        this.soundSystem = soundSystem;</span>

<span class="fc" id="L57">        states.put(GameStateName.newGame, new NewGameState(this));</span>
<span class="fc" id="L58">        states.put(GameStateName.active, new ActiveGameState(this));</span>
<span class="fc" id="L59">        states.put(GameStateName.paused, new PauseGameState(this));</span>
<span class="fc" id="L60">        states.put(GameStateName.gameOver, new FinishedGameState(this));</span>
<span class="fc" id="L61">        gameUpdateTimer = new Timer&lt;&gt;(this::run);</span>
<span class="fc" id="L62">        gameUpdateTimer.setActive(false);</span>

<span class="fc" id="L64">        powerUpFactory = new PowerUpFactory(this);</span>


<span class="fc" id="L67">    }</span>




    /**
     * Spawns in all sprites.
     */
    public void spawnSprites() {
<span class="fc" id="L76">        snake = new Snake(board,0, 0, 5);</span>

<span class="fc" id="L78">        Apple apple = Apple.spawnApplePersistent(this);</span>
<span class="fc" id="L79">        apples = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L80">        apples.add(apple);</span>

<span class="fc" id="L82">    }</span>

    /**
     * Handles update timer.
     */
    public void updateBoardTimer() {
<span class="nc" id="L88">        gameUpdateTimer.timerHandler(System.currentTimeMillis());</span>
<span class="nc" id="L89">    }</span>

    /**
     * Enters a state.
     *
     * @param gameStateName the name of the state
     */
    public void enterState(GameStateName gameStateName) {
<span class="fc" id="L97">        GameState state = states.get(gameStateName);</span>
<span class="pc bpc" id="L98" title="1 of 4 branches missed.">        assert state != null;</span>
<span class="fc" id="L99">        this.state = state;</span>
<span class="fc" id="L100">        state.enter();</span>
<span class="fc" id="L101">    }</span>

    /**
     * Game update.
     */
    public void run() {
<span class="fc bfc" id="L107" title="All 2 branches covered.">        if (hasDied()) {</span>
<span class="fc" id="L108">            return;</span>
        }

<span class="fc" id="L111">        eatAppleIfCollided();</span>
<span class="fc" id="L112">        spawnPowerUpIfPossible();</span>
<span class="fc" id="L113">        eatPowerUpIfCollided();</span>
<span class="fc" id="L114">    }</span>

    @SuppressWarnings(&quot;PMD&quot;)
    // should be able to put powerUp back to null again.
    private boolean hasDied() {
<span class="fc bfc" id="L119" title="All 2 branches covered.">        if (snake.move(board)) {</span>
<span class="fc" id="L120">            soundSystem.getDeathSound().play();</span>
<span class="fc" id="L121">            enterState(GameStateName.gameOver);</span>
<span class="fc" id="L122">            powerUp = null;</span>
<span class="fc" id="L123">            apples.clear();</span>
<span class="fc" id="L124">            return true;</span>
        }
<span class="fc" id="L126">        return false;</span>
    }

    private void eatAppleIfCollided() {
<span class="fc bfc" id="L130" title="All 2 branches covered.">        for (int i = 0; i &lt; apples.size(); i++) {</span>
<span class="fc bfc" id="L131" title="All 2 branches covered.">            if (snake.collides(apples.get(i).getPosX(), apples.get(i).getPosY())) {</span>
<span class="fc" id="L132">                soundSystem.getEatingSound().play();</span>
<span class="fc" id="L133">                apples.get(i).consume(this, snake);</span>
<span class="fc" id="L134">                apples.remove(apples.get(i));</span>
            }
        }
<span class="fc bfc" id="L137" title="All 2 branches covered.">        if (apples.size() == 0) {</span>
<span class="fc" id="L138">            apples.add(Apple.spawnApplePersistent(this));</span>
        }
<span class="fc" id="L140">    }</span>

    private void spawnPowerUpIfPossible() {
<span class="fc bfc" id="L143" title="All 2 branches covered.">        if (powerUp == null) {</span>
<span class="fc" id="L144">            double chance = Math.random();</span>
<span class="fc" id="L145">            int powerUpIndex = (int) (Math.random() * PowerUpName.values().length);</span>
<span class="fc" id="L146">            updatePowerUp(chance, PowerUpName.values()[powerUpIndex]);</span>
        }
<span class="fc" id="L148">    }</span>

    @SuppressWarnings(&quot;PMD&quot;)
    // should be able to put powerUp back to null again.
    private void eatPowerUpIfCollided() {
<span class="fc bfc" id="L153" title="All 4 branches covered.">        if (powerUp != null &amp;&amp; snake.collides(powerUp.getPosX(), powerUp.getPosY())) {</span>
<span class="fc" id="L154">            soundSystem.getPowerUpSound().play();</span>
<span class="fc" id="L155">            powerUp.consume(this, snake);</span>
<span class="fc" id="L156">            powerUp = null;</span>
        }
<span class="fc" id="L158">    }</span>

    /**
     * Method to update current powerUp. Chooses what powerUp to use (if any).
     *
     * @param chance random seed
     * @param powerUpName the new powerup
     */
    public void updatePowerUp(double chance, PowerUpName powerUpName) {
<span class="fc" id="L167">        final double threshold = 0.01;</span>
<span class="fc bfc" id="L168" title="All 2 branches covered.">        if (chance &lt;= threshold) {</span>
<span class="fc" id="L169">            powerUp = powerUpFactory.getPowerUp(powerUpName);</span>
        }
<span class="fc" id="L171">    }</span>

    /**
     * Adds more apples to the board.
     *
     * @param number of apples to add.
     */
    public void addApples(int number) {
<span class="fc bfc" id="L179" title="All 2 branches covered.">        if (number &lt; maxApples) {</span>
<span class="fc bfc" id="L180" title="All 2 branches covered.">            for (int i = 0; i &lt; number; i++) {</span>
<span class="fc" id="L181">                apples.add(Apple.spawnApplePersistent(this));</span>
            }
        }
<span class="fc" id="L184">    }</span>


    /**
     * Method to update snake direction.
     *
     * @param direction direction of a snake
     */
    public void updateDirection(Snake.Direction direction) {

<span class="fc" id="L194">        snake.getDirection().enqueue(direction);</span>

<span class="fc" id="L196">    }</span>

    public boolean isPortalWalls() {
<span class="nc" id="L199">        return portalWalls;</span>
    }

    public void setPortalWalls(boolean portalWalls) {
<span class="nc" id="L203">        this.portalWalls = portalWalls;</span>
<span class="nc" id="L204">    }</span>

    public boolean isStopGrowFlag() {
<span class="fc" id="L207">        return stopGrowFlag;</span>
    }

    public void setStopGrowFlag(boolean stopGrowFlag) {
<span class="fc" id="L211">        this.stopGrowFlag = stopGrowFlag;</span>
<span class="fc" id="L212">    }</span>

    public Snake getSnake() {
<span class="fc" id="L215">        return snake;</span>
    }

    public void setSnake(Snake snake) {
<span class="fc" id="L219">        this.snake = snake;</span>
<span class="fc" id="L220">    }</span>

    public ArrayList&lt;Apple&gt; getApples() {
<span class="fc" id="L223">        return apples;</span>
    }

    public void setApples(ArrayList&lt;Apple&gt; apples) {
<span class="fc" id="L227">        this.apples = apples;</span>
<span class="fc" id="L228">    }</span>

    public PowerUp getPowerUp() {
<span class="fc" id="L231">        return powerUp;</span>
    }

    public void setPowerUp(PowerUp powerUp) {
<span class="fc" id="L235">        this.powerUp = powerUp;</span>
<span class="fc" id="L236">    }</span>

    public PowerUpFactory getPowerUpFactory() {
<span class="nc" id="L239">        return powerUpFactory;</span>
    }

    public void setPowerUpFactory(PowerUpFactory powerUpFactory) {
<span class="nc" id="L243">        this.powerUpFactory = powerUpFactory;</span>
<span class="nc" id="L244">    }</span>

    public Board getBoard() {
<span class="fc" id="L247">        return board;</span>
    }

    public void setBoard(Board board) {
<span class="nc" id="L251">        this.board = board;</span>
<span class="nc" id="L252">    }</span>

    public GameState getState() {
<span class="fc" id="L255">        return state;</span>
    }

    public void setState(GameState state) {
<span class="nc" id="L259">        this.state = state;</span>
<span class="nc" id="L260">    }</span>

    public Score getScore() {
<span class="fc" id="L263">        return score;</span>
    }

    public void setScore(Score score) {
<span class="fc" id="L267">        this.score = score;</span>
<span class="fc" id="L268">    }</span>

    public SoundSystem getSoundSystem() {
<span class="fc" id="L271">        return soundSystem;</span>
    }

    public void setSoundSystem(SoundSystem soundSystem) {
<span class="nc" id="L275">        this.soundSystem = soundSystem;</span>
<span class="nc" id="L276">    }</span>

    public Timer&lt;Runnable&gt; getGameUpdateTimer() {
<span class="fc" id="L279">        return gameUpdateTimer;</span>
    }

    public HashMap&lt;GameStateName, GameState&gt; getStates() {
<span class="nc" id="L283">        return states;</span>
    }

    /**
     * Method to draw LengthPowerUp.
     *
     * @param posX x coord
     * @param posY y coord
     */
    public void drawLengthPowerUp(int posX, int posY) {
<span class="nc" id="L293">        this.drawPowerUp(Color.PINK, posX, posY);</span>
<span class="nc" id="L294">    }</span>

    /**
     * Method to draw MegaApple.
     *
     * @param posX x coord
     * @param posY y coord
     */
    public void drawMegaApple(int posX, int posY) {
<span class="nc" id="L303">        this.drawPowerUp(Color.LIME, posX, posY);</span>
<span class="nc" id="L304">    }</span>

    /**
     * Method to draw MoreApples.
     *
     * @param posX x coord
     * @param posY y coord
     */
    public void drawMoreApples(int posX, int posY) {
<span class="nc" id="L313">        this.drawPowerUp(Color.BLUE, posX, posY);</span>
<span class="nc" id="L314">    }</span>

    /**
     * Method to draw SpeedUp.
     *
     * @param posX x coord
     * @param posY y coord
     */
    public void drawSpeedUp(int posX, int posY) {
<span class="nc" id="L323">        this.drawPowerUp(Color.RED, posX, posY);</span>
<span class="nc" id="L324">    }</span>

    /**
     * Method to draw StopGrow.
     *
     * @param posX x coord
     * @param posY y coord
     */
    public void drawStopGrow(int posX, int posY) {
<span class="nc" id="L333">        this.drawPowerUp(Color.ORANGE, posX, posY);</span>
<span class="nc" id="L334">    }</span>

    /**
     * Method to draw a powerup.
     *
     * @param color the color
     * @param posX x coord
     * @param posY y coord
     */
    private void drawPowerUp(Color color, int posX, int posY) {
<span class="nc" id="L344">        this.getBoard().getRend().setColor(color);</span>
<span class="nc" id="L345">        this.getBoard().getRend().circle(</span>
<span class="nc" id="L346">                this.getBoard().getBoardX() + (posX + .5f) * this.getBoard().getTile(),</span>
<span class="nc" id="L347">                this.getBoard().getBoardY() + (posY + .5f) * this.getBoard().getTile(),</span>
<span class="nc" id="L348">                this.getBoard().getTile());</span>
<span class="nc" id="L349">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>